<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="0.什么是依赖注入首先我们应该都知道什么是依赖，废话不多说直接上代码： 1234class A &amp;#123;    B b；    C c;&amp;#125; 如上图代码，我们知道class A 对class B 和 class C有依赖，而依赖注入则是如何把class B 和 class C引入class A的过程和方法，依赖注入听着十分高大上，其实就在我们平时写的代码中就有着许多的依赖注入的例子,你">
<meta property="og:type" content="article">
<meta property="og:title" content="Dagger2">
<meta property="og:url" content="http://codeideal.com/2017/01/03/Dagger2/index.html">
<meta property="og:site_name" content="CodeIdeal">
<meta property="og:description" content="0.什么是依赖注入首先我们应该都知道什么是依赖，废话不多说直接上代码： 1234class A &amp;#123;    B b；    C c;&amp;#125; 如上图代码，我们知道class A 对class B 和 class C有依赖，而依赖注入则是如何把class B 和 class C引入class A的过程和方法，依赖注入听着十分高大上，其实就在我们平时写的代码中就有着许多的依赖注入的例子,你">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://ww2.sinaimg.cn/large/a15b4afegy1fi325oo9l6j20k2069mx5">
<meta property="og:updated_time" content="2018-09-29T06:26:17.333Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dagger2">
<meta name="twitter:description" content="0.什么是依赖注入首先我们应该都知道什么是依赖，废话不多说直接上代码： 1234class A &amp;#123;    B b；    C c;&amp;#125; 如上图代码，我们知道class A 对class B 和 class C有依赖，而依赖注入则是如何把class B 和 class C引入class A的过程和方法，依赖注入听着十分高大上，其实就在我们平时写的代码中就有着许多的依赖注入的例子,你">
<meta name="twitter:image" content="http://ww2.sinaimg.cn/large/a15b4afegy1fi325oo9l6j20k2069mx5">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Dagger2</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/codeideal">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/03/15/zxing-QR二维码识别/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2016/11/15/VirtualBox安装Linux虚拟机共享文件/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://codeideal.com/2017/01/03/Dagger2/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://codeideal.com/2017/01/03/Dagger2/&text=Dagger2"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://codeideal.com/2017/01/03/Dagger2/&is_video=false&description=Dagger2"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Dagger2&body=Check out this article: http://codeideal.com/2017/01/03/Dagger2/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://codeideal.com/2017/01/03/Dagger2/&name=Dagger2&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-什么是依赖注入"><span class="toc-number">1.</span> <span class="toc-text">0.什么是依赖注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-什么是Dagger2"><span class="toc-number">2.</span> <span class="toc-text">1.什么是Dagger2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-引入Dagger2到你的工程"><span class="toc-number">3.</span> <span class="toc-text">2.引入Dagger2到你的工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android-Gradle"><span class="toc-number">4.</span> <span class="toc-text">Android Gradle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Dagger2基本框架"><span class="toc-number">5.</span> <span class="toc-text">3.Dagger2基本框架</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-inject-和-component注解"><span class="toc-number">5.1.</span> <span class="toc-text">3.1 @inject 和 @component注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-module-和-provider-注解"><span class="toc-number">5.2.</span> <span class="toc-text">3.3 @module 和  @provider 注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-Qualifier-和-Named注解"><span class="toc-number">5.3.</span> <span class="toc-text">3.4 @Qualifier 和 @Named注解</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Dagger2
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">CodeIdeal</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-01-03T20:02:24.000Z" itemprop="datePublished">2017-01-03</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="0-什么是依赖注入"><a href="#0-什么是依赖注入" class="headerlink" title="0.什么是依赖注入"></a>0.什么是依赖注入</h3><p>首先我们应该都知道什么是依赖，废话不多说直接上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    B b；</span><br><span class="line">    C c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上图代码，我们知道class A 对class B 和 class C有依赖，而依赖注入则是如何把class B 和 class C引入class A的过程和方法，依赖注入听着十分高大上，其实就在我们平时写的代码中就有着许多的依赖注入的例子,你肯定不信，那我们来看看依赖注入最常见的三种常规方式吧：</p>
<ul>
<li>构造方法注入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">	B b；</span><br><span class="line">    C c;</span><br><span class="line">	</span><br><span class="line">	A(B b, C c) &#123;</span><br><span class="line">    	<span class="keyword">this</span>.b = b;</span><br><span class="line">      	<span class="keyword">this</span>.c = c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>set方法注入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">	B b；</span><br><span class="line">    C c;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setB</span><span class="params">(B b)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="function"><span class="keyword">void</span> <span class="title">setC</span><span class="params">(C c)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.c = c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>接口注入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Inject</span></span>&#123;</span><br><span class="line">  	inject(B b);</span><br><span class="line">  	inject(C c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Inject</span></span>&#123;</span><br><span class="line">	B b；</span><br><span class="line">    C c;</span><br><span class="line">	</span><br><span class="line"> 	<span class="meta">@override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(B b)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="meta">@override</span></span><br><span class="line">  	<span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(C c)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.c = c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到这你肯定会想：“啥？！这也算依赖注入？”。我要十分肯定的告诉你：是的！这就是依赖注入。</p>
<p>而正式这种常见的依赖注入方式免不了会在class A中去new 一个依赖的B或C对象，更有甚者，B 或 C又需要依赖其他类。这样的话这样在构造依赖对象的时候就会把大量的代码和时间浪费在依赖关系上，又由于直接调用的构造方法是不可能动态改变的还会造成代码的耦合。</p>
<p>因此，java中有许多的依赖注入框架来解决这个问题，在java后端中应该最流行的就是Spring框架了吧，通过注解方式完成依赖的注入，在写代码的时候不关心引用对象的依赖关系，只需要拿到对象调用方法即可，是不是很方便。而同时在Android开发中也有一个这样的框架，也即是今天的主角——Dagger2.</p>
<h3 id="1-什么是Dagger2"><a href="#1-什么是Dagger2" class="headerlink" title="1.什么是Dagger2"></a>1.什么是Dagger2</h3><p>引用Google文档中的一句话:</p>
<blockquote>
<p>Dagger is a fully static, compile-time dependency injection framework for both Java and Android. </p>
</blockquote>
<p>翻译过来就是:</p>
<blockquote>
<p>Dagger是用于java和Android的，完全静态的编译时依赖注入框架。</p>
</blockquote>
<p>完全静态保证了可追溯性，而编译时则说明Dagger2完全弃用了使用反射的方式在运行时进行注入，而是在代码编译期，生成代码实现依赖注入，这完全避免了运行时的反射注入造成的额外性能消耗。</p>
<h3 id="2-引入Dagger2到你的工程"><a href="#2-引入Dagger2到你的工程" class="headerlink" title="2.引入Dagger2到你的工程"></a>2.引入Dagger2到你的工程</h3><blockquote>
<h3 id="Android-Gradle"><a href="#Android-Gradle" class="headerlink" title="Android Gradle"></a>Android Gradle</h3><p>引入Dagger2需要的依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; dependencies &#123;</span><br><span class="line">&gt;   compile &apos;com.google.dagger:dagger:2.x&apos;</span><br><span class="line">&gt;   annotationProcessor &apos;com.google.dagger:dagger-compiler:2.x&apos;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>如果你使用了 <code>dagger.android</code> 你还需要引入以下依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; compile &apos;com.google.dagger:dagger-android:2.x&apos;</span><br><span class="line">&gt; compile &apos;com.google.dagger:dagger-android-support:2.x&apos; // if you use the support libraries</span><br><span class="line">&gt; annotationProcessor &apos;com.google.dagger:dagger-android-processor:2.x&apos;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>如果你是用的gradle插件版本号小于 <code>2.2</code>, 参见 <a href="https://bitbucket.org/hvisser/android-apt" target="_blank" rel="noopener">https://bitbucket.org/hvisser/android-apt</a>.</p>
</blockquote>
<h3 id="3-Dagger2基本框架"><a href="#3-Dagger2基本框架" class="headerlink" title="3.Dagger2基本框架"></a>3.Dagger2基本框架</h3><p>先来一段代码吧，一下就是很简单的dagger2示例代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  	<span class="meta">@inject</span></span><br><span class="line">	User user;</span><br><span class="line">  	</span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    	DaggerPersonComponent.builder().build().inject(<span class="keyword">this</span>);</span><br><span class="line">      	user.say();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="meta">@component</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonComponent</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(Person person)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  	String name;</span><br><span class="line">  </span><br><span class="line">	<span class="meta">@inject</span></span><br><span class="line">  	User()&#123;</span><br><span class="line">    	<span class="keyword">this</span>.name = <span class="string">"kaka"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">()</span></span>&#123;</span><br><span class="line">      	System.out.println(<span class="string">"my name is"</span>+<span class="keyword">this</span>.name);</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是只使用@inject 和 @component 两个注解实现的最简单的Dagger2例子。</p>
<h4 id="3-1-inject-和-component注解"><a href="#3-1-inject-和-component注解" class="headerlink" title="3.1 @inject 和 @component注解"></a>3.1 @inject 和 @component注解</h4><p>@inject是Dagger2的最基本的注解，它本身包含了两种含义注入和提供注入(特殊情况下它能同时表达这两个含义):</p>
<ol>
<li>一是标注目标类中所依赖的其他类（适用于构造方法 和 成员变量），需要依赖的地方</li>
<li>二是标注所依赖的其他类的构造函数，提供依赖的地方</li>
</ol>
<p>在有了@inject注解后dagger2怎么知道把相应的构造方法注入到对应的引用中去呢，那就是靠@component注解了。@component注解又叫注入器是连接目标类和依赖类的桥梁。@component注解的使用一般有两种方法:</p>
<ol>
<li><code>void inject(目标类 obj);</code>Dagger2 会从目标类开始查找 @Inject 注解，自动生成依赖注入的代码，调用 inject 可完成依赖的注入。</li>
<li><code>Object getObj();</code> 如：<code>User getUser();</code><br>Dagger2 会到 User 类中找被 @Inject 注解标注的构造器，自动生成提供 User 依赖的代码，这种方式一般为其他 Component 提供依赖。（一个 Component 可以依赖另一个 Component，后面会说）</li>
</ol>
<p>@inject 和 @component的关系可以用下图来解释:</p>
<p><img src="http://ww2.sinaimg.cn/large/a15b4afegy1fi325oo9l6j20k2069mx5" alt=""></p>
<p>@component先查找目标类中用<code>@Inject</code>标注的成员变量，然后再到相应的类中去寻找有@inject注解的构造方法，最后调用构造方法生成对象实例注入给目标类的相应成员变量。</p>
<h4 id="3-3-module-和-provider-注解"><a href="#3-3-module-和-provider-注解" class="headerlink" title="3.3 @module 和  @provider 注解"></a>3.3 @module 和  @provider 注解</h4><p>上面的例子我们看到的依赖类都是无参的构造方法，那么如果依赖类的构造方法是带参数的怎么办呢？亦或是当我们依赖的类是第三方的类库，我们没办法去改变源码在构造方法上加上@inject注解，又怎么办呢？</p>
<p>这时候就要用到@module 和  @provider这两个注解了。还是拿上面的Person类做例子，如果User类的构造方法是带参数情况或者User类是第三方库中的类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  	String name;</span><br><span class="line">  </span><br><span class="line">  	User(String name)&#123;</span><br><span class="line">    	<span class="keyword">this</span>.name = name;</span><br><span class="line">  	&#125;</span><br><span class="line">  	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么，用上@module 和  @provider注解来提供依赖如下，同时修改@Component中对Module的依赖:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonModule</span></span>&#123;</span><br><span class="line">  	String name;	</span><br><span class="line">  </span><br><span class="line">  	PersonModule(String name)&#123;</span><br><span class="line">    	<span class="keyword">this</span>.name = name;</span><br><span class="line">  	&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line"> 	<span class="function">User <span class="title">provideUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> User(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="meta">@component</span>(modules = PersonModule.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonComponent</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(Order order)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Person类中注入User对象的时候就可以如下带参数传入了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  	<span class="meta">@inject</span></span><br><span class="line">	User user;</span><br><span class="line">  	</span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    	DaggerPersonComponent.builder().PersonModule(<span class="string">"kaka"</span>).build().inject(<span class="keyword">this</span>);</span><br><span class="line">      	user.say();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样User类的构造就完全由Module类接管了，不需要对User类做任何处理，即可在Person 类中进行注入。在@Component中添加modules 参数是告诉Component 注入器，可以从@module中获取依赖的实例对象。Component 就会在module中去找被 @Provide 标注的方法，这也相当于构造器的 @Inject，可以提供依赖。</p>
<p>另外，@Component 可以指定多个 @Module 的，并且 Component 也可以依赖其它 Component 存在。</p>
<h4 id="3-4-Qualifier-和-Named注解"><a href="#3-4-Qualifier-和-Named注解" class="headerlink" title="3.4 @Qualifier 和 @Named注解"></a>3.4 @Qualifier 和 @Named注解</h4><p>这两个都是用于区分相同的依赖(为同一个类，或继承某一个父类或者都实现了同一个接口)的，其中@Qualifier 是用来自定义限定符的，而 @Named 则是基于 String 的限定符。</p>
<p>当我有两个相同的依赖提供时，那么Dagger就不知道我们到底要提供哪一个依赖，因为它找到了两个。这时候我们就可以通过限定符为两个依赖分别打上标记，指定提供某个依赖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">比如Person类中有一个Face的抽象类,而有两个子类同时提供了依赖:</span><br><span class="line">class Person &#123;</span><br><span class="line">	@inject</span><br><span class="line">	@Named(&quot;Left&quot;)</span><br><span class="line">  	Hand leftHand;</span><br><span class="line">  	</span><br><span class="line">	@inject</span><br><span class="line">	@Right</span><br><span class="line">  	Hand rightHand;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line">@module</span><br><span class="line">class PersonModule &#123;</span><br><span class="line">  	@provides</span><br><span class="line">  	@Named(&quot;Left&quot;)</span><br><span class="line">  	Face providerLeftHand()&#123;</span><br><span class="line">      	return new LeftHand();</span><br><span class="line">  	&#125;</span><br><span class="line">  	</span><br><span class="line">  	@provides</span><br><span class="line">  	@Right</span><br><span class="line">  	Face providerRightHand()&#123;</span><br><span class="line">      	return new RightHand();</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line">@Qualifier</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface Right &#123;&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line">abstract class Hand&#123;</span><br><span class="line">  </span><br><span class="line">&#125; </span><br><span class="line">-----------------------------------------------</span><br><span class="line">class LeftHand extends Face&#123;</span><br><span class="line">  	LeftHand()&#123;</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line">class RightHand extendsFace&#123;</span><br><span class="line">  	RightHand()&#123;</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将限定符分别作用于对应的@Provides和 @inject两处，他们就能按限定符所对应的类关系中找到对应的依赖进行注入。</p>
<p>####3.5 @Component 的 dependence 和 @SubComponent</p>
<p>前面已经提到过Component是可以有依赖关系的，依然是Person的例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  	Hand rightHand;</span><br><span class="line">  	Hand lefthand;</span><br><span class="line">  </span><br><span class="line">  	Person(Hand rightHand, Hand Lefthand)&#123;</span><br><span class="line">      	<span class="keyword">this</span>.rightHand = rightHand;</span><br><span class="line">      	<span class="keyword">this</span>.lefthand = lefthand;</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HandModule</span></span>&#123;</span><br><span class="line">  	<span class="meta">@provides</span></span><br><span class="line">  	<span class="meta">@Named</span>(<span class="string">"Left"</span>)</span><br><span class="line">  	<span class="function">Hand <span class="title">providerLeftHand</span><span class="params">()</span></span>&#123;</span><br><span class="line">      	<span class="keyword">return</span> <span class="keyword">new</span> LeftHand();</span><br><span class="line">  	&#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="meta">@provides</span></span><br><span class="line">  	<span class="meta">@Right</span></span><br><span class="line">  	<span class="function">Hand <span class="title">providerRightHand</span><span class="params">()</span></span>&#123;</span><br><span class="line">      	<span class="keyword">return</span> <span class="keyword">new</span> RightHand();</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonModule</span></span>&#123;</span><br><span class="line">  	<span class="meta">@providers</span></span><br><span class="line">  	<span class="function">Person <span class="title">getPerson</span><span class="params">(@Right Hand rightHand，@Named(<span class="string">"Left"</span>)</span> Hand leftHand)</span>&#123;</span><br><span class="line">      	<span class="keyword">return</span> <span class="keyword">new</span> Person(rightHand,lefthand);</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="meta">@Component</span>(modules = HandModule.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">HandComponent</span></span>&#123;</span><br><span class="line">  	<span class="meta">@Named</span>(<span class="string">"Left"</span>)</span><br><span class="line">  	<span class="function">Hand <span class="title">getLeftHand</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">  	<span class="meta">@Right</span></span><br><span class="line">  	<span class="function">Hand <span class="title">getRightHand</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="meta">@Component</span>(modules = PersonModule.class,dependencies = HandComponent.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonComponent</span></span>&#123;</span><br><span class="line">  	<span class="function">Person <span class="title">getPerson</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="meta">@Component</span>(dependencies = PersonComponent.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">TargetComponent</span></span>&#123;</span><br><span class="line">  	<span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(TargetObject object)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，我们就可以在Target类中，这样使用:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">target</span></span>&#123;</span><br><span class="line">	<span class="meta">@inject</span></span><br><span class="line">  	person</span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span>&#123;</span><br><span class="line">      	DaggerTargetComponent.builder().personComponent(</span><br><span class="line">        	DaggerPersonComponent.builder().handComponent(</span><br><span class="line">            	DaggerHandComponent.builder().create()</span><br><span class="line">            )</span><br><span class="line">        ).build().inject(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Component中我们不需要在TargetComponent中额外指定依赖的Module，因为component中的dependencies参数已经做了这样的事情，有了这个参数，component会自动的去依赖所它自己依赖的component的module。</p>
<p>如果说@Component 的 dependence是一层一层的依赖关系，那么@SubComponent就可以说是自顶向下的继承关系，我们拿Android中常用的Context来举个例子:</p>
<p>很多工具类都需要使用到 Application 的 Context 对象，此时就可以用一个 Component 负责提供，我们可以命名为 AppComponent。<br>需要用到的 context 对象的 SharePreferenceComponent，ToastComponent 就可以它作为 Subcomponent 存在了。</p>
<p>而且在 AppComponent 中，我们可以很清晰的看到有哪些子 Component，因为在里面我们定义了很多<code>XxxComponent plus(Module... modules)</code></p>
<p>每个 ActivityComponent 也是可以作为 AppComponent 的 Subcomponent，这样可以更方便的进行依赖注入，减少重复代码。</p>
<p>参考链接：    <a href="https://google.github.io/dagger//users-guide.html" target="_blank" rel="noopener">https://google.github.io/dagger//users-guide.html</a></p>
<p>​            <a href="https://juejin.im/entry/587499ff128fe1006b42f7de" target="_blank" rel="noopener">https://juejin.im/entry/587499ff128fe1006b42f7de</a></p>
<p>​            <a href="http://www.jianshu.com/p/24af4c102f62" target="_blank" rel="noopener">http://www.jianshu.com/p/24af4c102f62</a></p>
<p>​            <a href="http://www.jianshu.com/p/5d6b21351086" target="_blank" rel="noopener">http://www.jianshu.com/p/5d6b21351086</a></p>
<p>​            <a href="http://www.jianshu.com/p/269c3f70ec1e" target="_blank" rel="noopener">http://www.jianshu.com/p/269c3f70ec1e</a></p>

  </div>
</article>
<div id="donate" class="donate">
    <a id="github" href="https://github.com/codeideal" target="_blank" class="pos-f tr3" title="Github"></a>
    <div id="DonateText" class="tr3">Donate</div>
    <ul id="donateBox" class="list pos-f tr3">
        <li id="PayPal">
            <a href="https://www.paypal.me/Codeideal" target="_blank">PayPal</a>
        </li>
        <li id="BTC" data-footnote="Copy addres and show QRCode">
            <button id="BTCBn" data-clipboard-target="#btc-key" alt="Copy to clipboard">Bitcoin</button>
        </li>
        <li id="AliPay">AliPay</li>
        <li id="WeChat">WeChat</li>
    </ul>
    <div id="QRBox" class="pos-f left-100">
        <div id="BTCQR" class="MainBox" style="background-image: url(https://i.ooxx.ooo/2018/07/18/5d91e9892cecfcf56bfca5e9d399e7bc.png)"></div>
        <div id="AliPayQR" class="MainBox" style="background-image: url(https://i.ooxx.ooo/2018/07/18/67e67665f64367d782dfe5a95101779f.png)"></div>
        <div id="WeChatQR" class="MainBox" style="background-image: url(https://i.ooxx.ooo/2018/07/18/262a0f87e93bbb37276ed72a5dece671.png)"></div>
    </div>
    <!-- Bitcoin 账号 -->
    <input id="btc-key" type="text" value="There is no bitcoin wallet yet." readonly="readonly">
</div>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/codeideal">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-什么是依赖注入"><span class="toc-number">1.</span> <span class="toc-text">0.什么是依赖注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-什么是Dagger2"><span class="toc-number">2.</span> <span class="toc-text">1.什么是Dagger2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-引入Dagger2到你的工程"><span class="toc-number">3.</span> <span class="toc-text">2.引入Dagger2到你的工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android-Gradle"><span class="toc-number">4.</span> <span class="toc-text">Android Gradle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Dagger2基本框架"><span class="toc-number">5.</span> <span class="toc-text">3.Dagger2基本框架</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-inject-和-component注解"><span class="toc-number">5.1.</span> <span class="toc-text">3.1 @inject 和 @component注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-module-和-provider-注解"><span class="toc-number">5.2.</span> <span class="toc-text">3.3 @module 和  @provider 注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-Qualifier-和-Named注解"><span class="toc-number">5.3.</span> <span class="toc-text">3.4 @Qualifier 和 @Named注解</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://codeideal.com/2017/01/03/Dagger2/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://codeideal.com/2017/01/03/Dagger2/&text=Dagger2"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://codeideal.com/2017/01/03/Dagger2/&is_video=false&description=Dagger2"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Dagger2&body=Check out this article: http://codeideal.com/2017/01/03/Dagger2/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://codeideal.com/2017/01/03/Dagger2/&title=Dagger2"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://codeideal.com/2017/01/03/Dagger2/&name=Dagger2&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Kang Yang <a href="/LoveStory"><i class="fa fa-heart"></i></a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/codeideal">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-110925633-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'codeideal';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


